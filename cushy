#!/bin/bash
set -e # Abort on errors

function show_help() {
cat << EOF
Usage: ${0##*/} [-c CURL_ARGS] [-e EDITOR] [-s SHELL] URL
Download URL, display it in EDITOR, and then, after promting, execute it with SHELL
EOF
}

# Possible command line arguments (do argument parsing later)
CURL_ARGS=""
SHELL='sh'
EDITOR=$EDITOR || "nano" # default to running nano
RESOURCE="$1"

function run_cushy() {
	# Create a temporary directory
	CUSHY_TEMP=`mktemp -d 2>/dev/null || mktemp -d -t 'cushy_tmpdir'`
	function clean_up() {
		rm -r "$CUSHY_TEMP"
		exit
	}
	trap clean_up EXIT

	# Download the file and write to it
	FILENAME="$CUSHY_TEMP/$(basename $RESOURCE)"
	curl $CURL_ARGS "$RESOURCE" > "$FILENAME"

	# Run the editor
	$EDITOR "$FILENAME"

	# Ask if we should install
	read -p "Are you sure you want to install this software? (y/n)" -r
	echo
	if [[ $REPLY =~ ^[Yy]$ ]]; then
		# Run the program
		$SHELL "$FILENAME"
	fi
}

run_cushy
